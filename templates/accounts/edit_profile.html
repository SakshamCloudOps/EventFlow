{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow rounded">
        <div class="card-header bg-primary text-white text-center">
          <h4 class="mb-0"><i class="bi bi-pencil-square me-2"></i>Edit Profile</h4>
        </div>

        <div class="card-body">
          <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="text-center mb-4">
              <div class="rounded-circle shadow mb-3 mx-auto d-flex align-items-center justify-content-center position-relative bg-light"
                   style="width: 130px; height: 130px; overflow: hidden;">

                {% if profile.profile_picture %}
                  <img id="preview-img" src="{{ profile.profile_picture.url }}"
                       class="img-fluid h-100 w-100 object-fit-cover position-absolute" alt="Profile Picture">
                {% else %}
                  <img id="preview-img" src="{% static 'default-avatar.png' %}"
                       class="img-fluid h-100 w-100 object-fit-cover position-absolute"
                       alt="Default Profile Picture"
                       onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                  <div class="w-100 h-100 d-flex align-items-center justify-content-center text-muted fs-6 fw-semibold"
                       style="z-index: 1;">ðŸ‘¤ Upload Photo</div>
                {% endif %}
              </div>

              <div class="form-group mt-2">
                {{ form.profile_picture.label_tag }} {{ form.profile_picture }}
              </div>
            </div>

            <!-- Full Name -->
            <div class="form-group mb-3">
              <label for="{{ form.full_name.id_for_label }}"><i class="bi bi-person-fill me-2"></i>Full Name</label>
              {{ form.full_name|add_class:"form-control" }}
            </div>

            <!-- Phone -->
            <div class="form-group mb-3">
              <label for="{{ form.phone.id_for_label }}"><i class="bi bi-telephone-fill me-2"></i>Phone</label>
              {{ form.phone|add_class:"form-control" }}
            </div>

            <!-- Education -->
            <div class="form-group mb-3">
              <label for="{{ form.education.id_for_label }}"><i class="bi bi-mortarboard-fill me-2"></i>Education</label>
              {{ form.education|add_class:"form-control" }}
            </div>

            <!-- Bio -->
            <div class="form-group mb-3">
              <label for="{{ form.bio.id_for_label }}"><i class="bi bi-file-earmark-person-fill me-2"></i>Bio</label>
              {{ form.bio|add_class:"form-control" }}
            </div>

            <!-- Gender -->
            <div class="form-group mb-3">
              <label for="{{ form.gender.id_for_label }}"><i class="bi bi-gender-ambiguous me-2"></i>Gender</label>
              {{ form.gender|add_class:"form-control" }}
            </div>

            <!-- Birth Date -->
            <div class="form-group mb-3">
              <label for="{{ form.birth_date.id_for_label }}"><i class="bi bi-calendar-heart me-2"></i>Birth Date</label>
              {{ form.birth_date|add_class:"form-control" }}
            </div>

            <!-- Location -->
            <div class="form-group mb-3">
              <label for="{{ form.location.id_for_label }}"><i class="bi bi-geo-alt-fill me-2"></i>Location</label>
              {{ form.location|add_class:"form-control" }}
            </div>

            <!-- Social Links -->
            <div class="form-group mb-3">
              <label for="{{ form.linkedin.id_for_label }}"><i class="bi bi-linkedin me-2"></i>LinkedIn</label>
              {{ form.linkedin|add_class:"form-control" }}
            </div>

            <div class="form-group mb-3">
              <label for="{{ form.github.id_for_label }}"><i class="bi bi-github me-2"></i>GitHub</label>
              {{ form.github|add_class:"form-control" }}
            </div>

            <div class="form-group mb-3">
              <label for="{{ form.instagram.id_for_label }}"><i class="bi bi-instagram me-2"></i>Instagram</label>
              {{ form.instagram|add_class:"form-control" }}
            </div>

            <!-- Submit -->
            <div class="d-grid mt-4">
              <button type="submit" class="btn btn-success">
                <i class="bi bi-check-circle-fill me-1"></i>Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>

      {% if messages %}
        <div class="mt-3">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} text-center">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const input = document.querySelector("#id_profile_picture");
    const previewImg = document.querySelector("#preview-img");

    input.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewImg.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  });
</script>
{% endblock %}
